<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script src="jquery-1.3.2.min.js"></script>
<title>Keyboard Experiment</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<style type="text/css" media="screen">

body { background-color: #fee; font: 15px Helvetica, Arial; color: #000; }

 #target {
 margin: 0 0 5px;
 padding: 5px;
 width: 671px;
 height: 200px;
 font: 1em/1.5 Verdana, Sans-Serif;
 background: fff;
 border: 1px solid f9f9f9;
 -moz-border-radius: 5px;
 -webkit-border-radius: 5px;
 }

 #omw_canvas {
 	 /*border: dashed 1px black;*/
 	 padding:5px;
 }

</style>
<textarea id="target">Type something here or click on the virtual keyboard</textarea>
<canvas id="omw_canvas" width="700" height="250"></canvas>
<br/>
Testing firing: <span id="out"></span>
<br/>
<div id="suggest" style="width:800px;">Yoz</div>
<script type="text/javascript">
// By Joshua Koo
// From testscrollbars5.html Added SpriateObject v1, Remove Frame rate

var sMode = true;

var c = 0;
var events = [];
var canvas, ctx, kbCanvas;
var strokes = [];
var drawing = false, clicked = false;
var trashLetters = [];


function c1(){
	d = new Date();
}
function c2(r) {
	d2 = new Date();
	$('#out').html(r+" " +(d2.getTime()-d.getTime())+"ms");
}

function jdictdecompress() {
	//var dict=[];
	var lastword = '';
	var re = /(\d*)(.*)/;
	var dict2 = jdictcompressed.split('|');
	var nword,w;
	for (var i in dict2) {
		nword = re.exec(dict2[i]);

		n = parseInt(nword[1]);
		 w = lastword.substr(0,n) + nword[2];
		//dict.push(w);
		dict2[i] = w;
		lastword = w;
	}
	return dict2;
}

c1();
</script>
<script src="jdictcompressed.js"></script>
<script>
c2('For compress jdict file');
c1();
dict= jdictdecompress(jdictcompressed);
c2('Decompressing takes');
function simpleSprite() { return {

}
}

function Sprite(o) {
	var s = simpleSprite();

	// Use new keys
	for (var k in o) {
		s[k] = o[k];

	}

	return s;
}

function frameRate() {
	if (events['mousemove']) {
		$('#out').html('Mouse moving');
		var e = events['mousemove'];
		strokes.push({x:e.x, y:e.y});
		kbCanvas.mousemove(e);
		kbCanvas.paint();

		if (drawing) {
			ctx.beginPath();
			ctx.moveTo(strokes[0].x,strokes[0].y);

			for (var s=1; s<strokes.length;s++) {
				ctx.lineTo(strokes[s].x,strokes[s].y);
			}
			ctx.stroke();
		}
		events = [];
	}

	//$('#out').html('Nothing');



}

function levenshtein(str1, str2) {
    var l1 = str1.length, l2 = str2.length;
    if (Math.min(l1, l2) === 0) {
        return Math.max(l1, l2);
    }
    var i = 0, j = 0, d = [];
    for (i = 0 ; i <= l1 ; i++) {
        d[i] = [];
        d[i][0] = i;
    }
    for (j = 0 ; j <= l2 ; j++) {
        d[0][j] = j;
    }
    for (i = 1 ; i <= l1 ; i++) {
        for (j = 1 ; j <= l2 ; j++) {
            d[i][j] = Math.min(
                d[i - 1][j] + 1,
                d[i][j - 1] + 1,
                d[i - 1][j - 1] + (str1.charAt(i - 1) === str2.charAt(j - 1) ? 0 : 1)
            );
        }
    }
    return d[l1][l2];
}

$(document).ready(function() {
		 canvas = $('#omw_canvas')[0];
         	  if (!canvas.getContext){
         	 	 alert("Sorry, your browser does not support html 5 canvas. Please try with another browser!!");
         	 	 return;
         	 }
         	  ctx = canvas.getContext("2d");
         	 CanvasTextFunctions.enable(ctx);

         	  kbCanvas = {
         	 	elements:[],
         	 	paint:function() {
         	 		ctx.clearRect(0,0,canvas.width,canvas.height);
         	 		for (var e in this.elements) {
         	 			this.elements[e].paint();
				}
			},
			mousemove:function(e) {
				if (clicked) {
					drawing = true;

				}
				$('#out').html('Mouse moving');
				var hit = false;
				for (var o in this.elements) {
					var o2 = this.elements[o];


					if (o2.clicked) {
						o2.isdragged = true;
						if (typeof o2.drag == 'function')
						o2.drag(e);
					}

					if (typeof o2.hover != 'function') continue;


					if ((o2.x<e.x)&&(o2.y<e.y)&&
						((o2.x+o2.w)>e.x)&&
						((o2.y+o2.h)>e.y)) {

						if (typeof o2.hover == 'function')
							o2.hover(e);
						hit = true;

					} else {
						if (o2.ishover) {
							o2.hoveroff(e);
						}
					}
				}
				if (!hit) {
					$('#omw_canvas').css({cursor:'auto'});
				}
			},
			mousedown:function(e) {
				clicked =true;
				strokes = [];
				trashLetters = [];
				strokes.push({x:e.x, y:e.y});
				$('#out').html('Mouse Down');
				for (var o in this.elements) {
					var o2 = this.elements[o];

					if ((o2.x<e.x)&&(o2.y<e.y)&&
						((o2.x+o2.w)>e.x)&&
						((o2.y+o2.h)>e.y)) {
						o2.clicked = true;

						if (typeof o2.mousedown == 'function')
						o2.mousedown(e);

						break;
					}
				}
			},
			mouseup:function(e) {
				clicked = false; drawing = false;
/*
				$('#target').val($('#target').val()+ " " +trashLetters.join(''));*/

var understandWord = trashLetters.join('').toLowerCase();
// Words to test. Hello. Wow. Hate\
c1();
var hh;
var c = 0, chose = 0;
var suggest = [];
for (var i in dict) {
hh=dict[i].toLowerCase();
	if (fitin2(hh, understandWord)) {
		var score =1;

		score += fitin(hh, understandWord);
		/*

		score += hh.length  / understandWord.length*4;
		*/
		score /= levenshtein(understandWord,hh ) ;
		if (hh[0]==understandWord[0]) score*= 1.5;
		if (hh[hh.length-1]==understandWord[understandWord.length-1]) score *= 1.5;
		/*

		*/
		//dictionary common words score
		//
		/*
		// try http://en.wikibooks.org/wiki/Algorithm_Implementation/Strings/Levenshtein_distance#JavaScript
		//Algo 5 . Edit distance
		var score = hh.length / levenshtein(understandWord,hh ) ;
		*/
		/*
		Algo 1 Emphasis on Length
		var score =0;
		score += hh.length  / understandWord.length;
		if (hh[0]==understandWord[0]) score*= 1.1;
		if (hh[hh.length-1]==understandWord[understandWord.length-1]) score *= 1.1;
		*/
		/*
		Algo 2 - Emphasis on End points
		var score =1;
		if (hh[0]==understandWord[0]) score+= 0.5;
		if (hh[hh.length-1]==understandWord[understandWord.length-1]) score += 0.5;
		score += hh.length  / understandWord.length;
		*/

		/* Algo 3 End points and Length Multiplier
		var score =0;
		if (hh[0]==understandWord[0]) score+= 0.5;
		if (hh[hh.length-1]==understandWord[understandWord.length-1]) score += 0.5;
		score += hh.length  / understandWord.length*4;
		*/

		var entry = {w:hh, s:score, toString:function() {return this.w; } }; // Word and Score
		//+ this.s
		suggest.push(entry);
		chose ++;
	}
	c++;
}

function sortByLength(a,b)
{
return b.s - a.s; //.length
}

suggest.sort(sortByLength);

//$('#target').val($('#target').val()+ " " +hh);
$('#suggest').html(':) Suggest '+suggest.join(',') + '<br/>Searching '+understandWord+' in '+c + " words. Chosen: " +chose);

c2('Suggestions takes');
				for (var o in this.elements) {
					var o2 = this.elements[o];
					if (o2.clicked) {
						o2.clicked = false;
						if (typeof o2.mouseup != 'function') continue;
						if ((o2.x<e.x)&&(o2.y<e.y)&&
							((o2.x+o2.w)>e.x)&&
							((o2.y+o2.h)>e.y)) {
							o2.mouseup(e);
							hit = true;
						}
					}
				}
			}
         	 };


         	 // Fuzzy score???? Fit in, Approximity by position, Score by matchness
         	 function fitin(a,b) {
			var lowest = -1;
			var c=0;
			for (var i in a) {
				var x = b.indexOf(a[i]);
				if (x<0) return c;
				b = b.substr(x+1);
				lowest = x;
				c++;
			}
			return c;
		}


         	function fitin2(a,b) {
         		if (a.length > b.length) return false;
         		if ((a[0]==b[0]) &&
         		 (a[a.length-1]==b[b.length-1]))
         		return true;

         		return false;
			var lowest = -1;
			for (var i in a) {
				var x = b.indexOf(a[i]);
				if (x<0) return false;
				b = b.substr(x+1);
				lowest = x;
			}
			return true;
		}


         	 var kbItems = [];
         	 kbItems[0] = [ '`','1','2','3','4','5','6','7','8','9','0','-','=','delete'];
         	 kbItems[1] = [ 'tab','q','w','e','r','t','y','u','i','o','p','[',']','\\'];
         	 kbItems[2] = [ 'caps','a','s','d','f','g','h','j','k','l', ';','\'','enter'];
         	 kbItems[4] = [ 'shift','z','x','c','v','b','n','m',',','.','/','shift'];
         	 kbItems[5] = [ 'space'];

         	 // CAPS

		function roundedRect(ctx,x,y,width,height,radius,hover, click){
			ctx.beginPath();
			ctx.moveTo(x,y+radius);
			ctx.lineTo(x,y+height-radius);
			ctx.quadraticCurveTo(x,y+height,x+radius,y+height);
			ctx.lineTo(x+width-radius,y+height);
			ctx.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);
			ctx.lineTo(x+width,y+radius);
			ctx.quadraticCurveTo(x+width,y,x+width-radius,y);
			ctx.lineTo(x+radius,y);
			ctx.quadraticCurveTo(x,y,x,y+radius);

			// 000 333 666 dark light ligher
			// click hover default 000 555 aaa , 000 999 555
			if (click) {
				ctx.strokeStyle = "#000";
				ctx.stroke();

			} else
			if (hover) {
				ctx.strokeStyle = "#999";

				ctx.stroke();
				//ctx.fillStyle = "yellow";
				//ctx.fill();
			} else {
				ctx.strokeStyle = "#555";
				ctx.stroke();
			}
		}

		function hover() {
			$('#out').html(':)');
			if (!this.ishover && drawing) {
				trashLetters.push(this.txt);

			 }
			this.ishover = true;
			//kbCanvas.paint();
			 $('#omw_canvas').css({cursor:'pointer'});

		}

		function hoveroff() {
			this.ishover = false;
			this.ispress = false;
			 $('#omw_canvas').css({cursor:'auto'});
		}

		function mousepress() {
			this.ispress = true;
			if (!sMode) $('#target').val($('#target').val()+this.txt);
			else trashLetters.push(this.txt);
		}

		function mouseup() {
			this.ispress = false;
		}

         	 function paint() {
         	 	 roundedRect(ctx, this.x , this.y, this.w, this.h, 5, this.ishover, this.ispress );
         	 	 //ctx.strokeRect(this.x , this.y, this.w, this.h ); //ctx.fillText(this.txt, this.x + this.w/2, this.y + this.h/2);
         	 	 ctx.drawTextCenter(null,12,this.x + this.w/2, this.y + this.h/2+5, this.txt);
         	 }

         	 function lookupwidth(c) {
         	 	 if (c=='tab') return 70;
         	 	 if (c=='delete') return 70;
         	 	 if (c=='caps') return 80;
         	 	 if (c=='enter') return 77;
         	 	 if (c=='shift') return 97;
         	 	 if (c=='space') return 660;

         	 	 return 40;
         	 }

         	 var kx,ky;
         	 var padding = 5;
         	 ky = padding;
         	 for (var i1 in kbItems) {
         	 	 kx = padding;
         	 	 for (i2 in kbItems[i1]) {
         	 	 	 var key1 = kbItems[i1][i2]

         	 	 	 var item = {txt: key1, x:kx, y:ky, w:lookupwidth(key1), h:40,
         	 	 	 paint:paint, hover:hover, hoveroff:hoveroff,
         	 	 	 mousedown:mousepress, mouseup:mouseup};
         	 	 	 kx+= item.w + padding;
         	 	 	  kbCanvas.elements.push(item);
         	 	 }
         	 	 ky+= padding + 40;
         	 }



		$('#omw_canvas').mousemove(function(e) {
			var x = e.pageX - $(this).offset().left;
			var y = e.pageY - $(this).offset().top;
			//kbCanvas.mousemove({x:x,y:y});
			events['mousemove'] = {x:x,y:y};

		}).mousedown(function(e) {
			var x = e.pageX - $(this).offset().left;
			var y = e.pageY - $(this).offset().top;
			kbCanvas.mousedown({x:x,y:y});

		}).mouseup(function(e) {
			var x = e.pageX - $(this).offset().left;
			var y = e.pageY - $(this).offset().top;
			kbCanvas.mouseup({x:x,y:y});
		});
		kbCanvas.paint();

		var fps = 50;
		setInterval(frameRate,1000/fps);
});



//
// This code is released to the public domain by Jim Studt, 2007.
// Corrected a mistake with ; by Joshua Koo
// He may keep some sort of up to date copy at http://www.federated.com/~jim/canvastext/
//
var CanvasTextFunctions = { };

CanvasTextFunctions.letters = {
    ' ': { width: 16, points: [] },
    '!': { width: 10, points: [[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]] },
    '"': { width: 16, points: [[4,21],[4,14],[-1,-1],[12,21],[12,14]] },
    '#': { width: 21, points: [[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]] },
    '$': { width: 20, points: [[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]] },
    '%': { width: 24, points: [[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]] },
    '&': { width: 26, points: [[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]] },
    '\'': { width: 10, points: [[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]] },
    '(': { width: 14, points: [[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]] },
    ')': { width: 14, points: [[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]] },
    '*': { width: 16, points: [[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]] },
    '+': { width: 26, points: [[13,18],[13,0],[-1,-1],[4,9],[22,9]] },
    ',': { width: 10, points: [[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]] },
    '-': { width: 26, points: [[4,9],[22,9]] },
    '.': { width: 10, points: [[5,2],[4,1],[5,0],[6,1],[5,2]] },
    '/': { width: 22, points: [[20,25],[2,-7]] },
    '0': { width: 20, points: [[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]] },
    '1': { width: 20, points: [[6,17],[8,18],[11,21],[11,0]] },
    '2': { width: 20, points: [[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]] },
    '3': { width: 20, points: [[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]] },
    '4': { width: 20, points: [[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]] },
    '5': { width: 20, points: [[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]] },
    '6': { width: 20, points: [[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]] },
    '7': { width: 20, points: [[17,21],[7,0],[-1,-1],[3,21],[17,21]] },
    '8': { width: 20, points: [[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]] },
    '9': { width: 20, points: [[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]] },
    ':': { width: 10, points: [[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]] },
    ';': { width: 10, points: [[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]] },
    '<': { width: 24, points: [[20,18],[4,9],[20,0]] },
    '=': { width: 26, points: [[4,12],[22,12],[-1,-1],[4,6],[22,6]] },
    '>': { width: 24, points: [[4,18],[20,9],[4,0]] },
    '?': { width: 18, points: [[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]] },
    '@': { width: 27, points: [[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]] },
    'A': { width: 18, points: [[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]] },
    'B': { width: 21, points: [[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]] },
    'C': { width: 21, points: [[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]] },
    'D': { width: 21, points: [[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]] },
    'E': { width: 19, points: [[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]] },
    'F': { width: 18, points: [[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]] },
    'G': { width: 21, points: [[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]] },
    'H': { width: 22, points: [[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]] },
    'I': { width: 8, points: [[4,21],[4,0]] },
    'J': { width: 16, points: [[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]] },
    'K': { width: 21, points: [[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]] },
    'L': { width: 17, points: [[4,21],[4,0],[-1,-1],[4,0],[16,0]] },
    'M': { width: 24, points: [[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]] },
    'N': { width: 22, points: [[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]] },
    'O': { width: 22, points: [[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]] },
    'P': { width: 21, points: [[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]] },
    'Q': { width: 22, points: [[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]] },
    'R': { width: 21, points: [[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]] },
    'S': { width: 20, points: [[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]] },
    'T': { width: 16, points: [[8,21],[8,0],[-1,-1],[1,21],[15,21]] },
    'U': { width: 22, points: [[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]] },
    'V': { width: 18, points: [[1,21],[9,0],[-1,-1],[17,21],[9,0]] },
    'W': { width: 24, points: [[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]] },
    'X': { width: 20, points: [[3,21],[17,0],[-1,-1],[17,21],[3,0]] },
    'Y': { width: 18, points: [[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]] },
    'Z': { width: 20, points: [[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]] },
    '[': { width: 14, points: [[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]] },
    '\\': { width: 14, points: [[0,21],[14,-3]] },
    ']': { width: 14, points: [[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]] },
    '^': { width: 16, points: [[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]] },
    '_': { width: 16, points: [[0,-2],[16,-2]] },
    '`': { width: 10, points: [[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]] },
    'a': { width: 19, points: [[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]] },
    'b': { width: 19, points: [[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]] },
    'c': { width: 18, points: [[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]] },
    'd': { width: 19, points: [[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]] },
    'e': { width: 18, points: [[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]] },
    'f': { width: 12, points: [[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]] },
    'g': { width: 19, points: [[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]] },
    'h': { width: 19, points: [[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]] },
    'i': { width: 8, points: [[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]] },
    'j': { width: 10, points: [[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]] },
    'k': { width: 17, points: [[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]] },
    'l': { width: 8, points: [[4,21],[4,0]] },
    'm': { width: 30, points: [[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]] },
    'n': { width: 19, points: [[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]] },
    'o': { width: 19, points: [[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]] },
    'p': { width: 19, points: [[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]] },
    'q': { width: 19, points: [[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]] },
    'r': { width: 13, points: [[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]] },
    's': { width: 17, points: [[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]] },
    't': { width: 12, points: [[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]] },
    'u': { width: 19, points: [[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]] },
    'v': { width: 16, points: [[2,14],[8,0],[-1,-1],[14,14],[8,0]] },
    'w': { width: 22, points: [[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]] },
    'x': { width: 17, points: [[3,14],[14,0],[-1,-1],[14,14],[3,0]] },
    'y': { width: 16, points: [[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]] },
    'z': { width: 17, points: [[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]] },
    '{': { width: 14, points: [[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]] },
    '|': { width: 8, points: [[4,25],[4,-7]] },
    '}': { width: 14, points: [[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]] },
    '~': { width: 24, points: [[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]] }
};

CanvasTextFunctions.letter = function (ch)
{
    return CanvasTextFunctions.letters[ch];
}

CanvasTextFunctions.ascent = function( font, size)
{
    return size;
}

CanvasTextFunctions.descent = function( font, size)
{
    return 7.0*size/25.0;
}

CanvasTextFunctions.measure = function( font, size, str)
{
    var total = 0;
    var len = str.length;

    for ( i = 0; i < len; i++) {
	var c = CanvasTextFunctions.letter( str.charAt(i));
	if ( c) total += c.width * size / 25.0;
    }
    return total;
}

CanvasTextFunctions.draw = function(ctx,font,size,x,y,str)
{
    var total = 0;
    var len = str.length;
    var mag = size / 25.0;

    ctx.save();
    ctx.lineCap = "round";
    ctx.lineWidth = 2.0 * mag;

    for ( i = 0; i < len; i++) {
	var c = CanvasTextFunctions.letter( str.charAt(i));
	if ( !c) continue;

	ctx.beginPath();

	var penUp = 1;
	var needStroke = 0;
	for ( j = 0; j < c.points.length; j++) {
	    var a = c.points[j];
	    if ( a[0] == -1 && a[1] == -1) {
		penUp = 1;
		continue;
	    }
	    if ( penUp) {
		ctx.moveTo( x + a[0]*mag, y - a[1]*mag);
		penUp = false;
	    } else {
		ctx.lineTo( x + a[0]*mag, y - a[1]*mag);
	    }
	}
	ctx.stroke();
	x += c.width*mag;
    }
    ctx.restore();
    return total;
}

CanvasTextFunctions.enable = function( ctx)
{
    ctx.drawText = function(font,size,x,y,text) { return CanvasTextFunctions.draw( ctx, font,size,x,y,text); };
    ctx.measureText = function(font,size,text) { return CanvasTextFunctions.measure( font,size,text); };
    ctx.fontAscent = function(font,size) { return CanvasTextFunctions.ascent(font,size); }
    ctx.fontDescent = function(font,size) { return CanvasTextFunctions.descent(font,size); }

    ctx.drawTextRight = function(font,size,x,y,text) {
	var w = CanvasTextFunctions.measure(font,size,text);
	return CanvasTextFunctions.draw( ctx, font,size,x-w,y,text);
    };
    ctx.drawTextCenter = function(font,size,x,y,text) {
	var w = CanvasTextFunctions.measure(font,size,text);
	return CanvasTextFunctions.draw( ctx, font,size,x-w/2,y,text);
    };
}


</script>

</body>
</html>